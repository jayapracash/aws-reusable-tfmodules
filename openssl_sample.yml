---
  - name: Linux Test Playbook
    hosts: localhost
    vars:
      directory: /tmp
    tasks:
      - name: create private key
        openssl_privatekey:
          path: /tmp/mysample.key
          size: 2048 
      
      - name: create certificate signing request file
        openssl_csr:
          path: /tmp/mysample.csr
          privatekey_path: /tmp/mysample.key
          country_name: IN
          organization_name: "charan Company"
          common_name: "mysample"
          subject_alt_name: "DNS:{{ ansible_host }},DNS:{{ ansible_fqdn }}"

      - name: create self signed certificate files 
        openssl_certificate:
          provider: selfsigned
          path: /tmp/mysample.crt
          privatekey_path: /tmp/mysample.key
          csr_path: /tmp/mysample.csr

      - name: printing files generated
        command: "ls {{directory}}"
        register: dir_out
      - debug: var={{item}}
        with_items: dir_out.stdout_lines
      
      - name: validating cert files 
        command: "openssl req -noout -text -in {{directory}}/mysample.csr"
        register: cmd_out
      - debug: var={{item}}
        with_items: cmd_out.stdout_lines
